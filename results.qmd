# Results


## Geospatial Density Map

```{r}
library(sf)
library(ggplot2)
library(ggdensity)
library(dplyr)

# 1. Load the Shapefile
nyc_map <- read_sf("C:/Users/famig/OneDrive/Scuola/0 Columbia University/1 Fall 2025/STAT GR5702 - Exploratory Data Analysis & Visualization/EDAV/nybb_25d/nybb.shp") %>%
  st_transform(crs = 4326)

# 2. Data Cleaning for Geospatial Analysis
# We create a specific subset to avoid overwriting the main dataset accidentally
restaurants_geo <- restaurants %>%
  # IMPORTANT FIX: Remove rows without coordinates
  filter(!is.na(Longitude) & !is.na(Latitude)) %>%
  # Remove valid but incorrect coordinates (e.g., 0,0 points that land in the ocean)
  filter(Longitude < -70 & Latitude > 35)

# 3. Test Dot Map (Optional - run this first to check if points align with the map)
# This is lighter to render than the density map
ggplot() +
  geom_sf(data = nyc_map, fill = "grey95", color = "grey80") +
  geom_point(data = restaurants_geo, 
             aes(x = Longitude, y = Latitude), 
             size = 0.1, alpha = 0.1, color = "red") +
  facet_wrap(~ cuisine_group) +
  theme_void() +
  labs(title = "Dot Map Test: Restaurant Locations")

# 4. Final Density Heatmap
# Note: This creates a Kernel Density Estimation (KDE) over the map
ggplot() +
  # Base map layer
  geom_sf(data = nyc_map, fill = "grey95", color = "grey80", linewidth = 0.3) +
  
  # Density layer
  geom_hdr(data = restaurants_geo, 
           aes(x = Longitude, y = Latitude, fill = after_stat(probs)), 
           method = "kde", alpha = 0.6) +
  
  # Facet by cuisine to see specific clustering
  facet_wrap(~ cuisine_group, nrow = 3) + # Increased rows for better visibility
  
  # Styling
  scale_fill_viridis_d(option = "A", direction = -1, name = "Probability") +
  theme_void() +
  labs(title = "Restaurant Hotspots by Cuisine in NYC",
       subtitle = "Spatial density estimation of inspection locations",
       caption = "Source: NYC DOHMH & NYC Planning") +
  theme(strip.text = element_text(face = "bold"),
        legend.position = "bottom")
```

By overlaying restaurant coordinates on the NYC borough map using Kernel Density Estimation (KDE), we can visualize the spatial clustering of different culinary traditions. This visualization moves beyond simple counts to reveal distinct cultural enclaves (such as the three major "Chinatowns" in Manhattan, Queens, and Brooklyn) versus cuisines that are uniformly distributed across the city, such as American or Cafe/Deli establishments.


## Hygiene Score Analysis

```{r}
library(ggplot2)
library(dplyr)

# Filter data for the plot
score_analysis <- restaurants %>%
  # Exclude "Other" to keep the comparison meaningful
  filter(cuisine_group != "Other") %>%
  # Remove extreme outliers (scores > 60 are rare) for better readability
  filter(mean_score < 60)

# Combined Boxplot + Violin Plot
ggplot(score_analysis, aes(x = reorder(cuisine_group, mean_score, FUN = median), y = mean_score)) +
  
  # Violin plot (bottom layer): Shows the shape/density of the distribution
  geom_violin(fill = "grey90", color = NA, alpha = 0.5) +
  
  # Boxplot (top layer): Shows median and quartiles
  geom_boxplot(width = 0.2, fill = "steelblue", outlier.size = 0.5, outlier.alpha = 0.3) +
  
  # Dashed red line at 13 (Threshold for Grade A)
  geom_hline(yintercept = 13, linetype = "dashed", color = "red", linewidth = 0.8) +
  annotate("text", x = 1, y = 14.5, label = "Grade A Limit (13)", 
           color = "red", size = 3, hjust = 0) +
  
  # Flip coordinates for readable labels
  coord_flip() + 
  labs(title = "Hygiene Scores by Cuisine Type",
       subtitle = "Lower score indicates better hygiene performance",
       x = "Cuisine Group",
       y = "Average Inspection Score") +
  theme_minimal() +
  theme(
    axis.text.y = element_text(face = "bold", size = 10),
    plot.title = element_text(face = "bold")
  )
```

We utilized a combined violin and boxplot to analyze the distribution of hygiene scores across cuisine groups. The red dashed line at a score of 13 marks the critical threshold for an "A" grade; the plot reveals that while the median scores for most cuisines fall within the "A" range, certain groups (such as Latin American and Asian cuisines) exhibit a wider distribution with a longer tail of higher scores, suggesting higher variance in compliance or inspection complexity.

